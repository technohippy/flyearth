<!DOCTYPE html>

<html>

<head>
    <title>Example 10.06 - Specular map</title>
    <script type="text/javascript" src="libs/three.js"></script>

    <script type="text/javascript" src="libs/stats.js"></script>
    <script type="text/javascript" src="libs/dat.gui.js"></script>
    <script type="text/javascript" src="libs/OrbitControls.js"></script>

    <!-- vr -->
    <!--script type="text/javascript" src="libs/WebVR.js"></script-->
    <script type="text/javascript" src="libs/VREffect.js"></script>
    <script type="text/javascript" src="libs/CardboardEffect.js"></script>
    <script type="text/javascript" src="libs/VRControls.js"></script>
    <script type="text/javascript" src="libs/DeviceOrientationControls.js"></script>
    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<div id="Stats-output">
</div>
<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
    //if (WEBVR.isLatestAvailable() === false) {
    //    document.body.appendChild(WEBVR.getMessage());
    //}

    // once everything is loaded, we run our Three.js stuff.
    function init() {

        var stats = initStats();

        // create a scene, that will hold all our elements such as objects, cameras and lights.
        var scene = new THREE.Scene();

        // create a camera, which defines where we're looking at.
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);

        // create a render and set the size
        var webGLRenderer = new THREE.WebGLRenderer();
        webGLRenderer.setClearColor(new THREE.Color(0x000, 1.0));
        webGLRenderer.setSize(window.innerWidth, window.innerHeight);
        webGLRenderer.shadowMap.enabled = true;

        var earth = createEarthMesh(new THREE.SphereGeometry(10, 80, 80));
        // add the sphere to the scene
        earth.position.y = -10;
        scene.add(earth);

        var air = createAirMesh(new THREE.SphereGeometry(10.1, 80, 80));
        air.position.copy(earth.position);
        scene.add(air);

        var moon = createMoonMesh(new THREE.SphereGeometry(5, 20, 20));
        moon.position.x = -50;
        earth.add(moon);

        var pos = earth.position;
        var rad = Math.abs(moon.position.x);
        earth.add(createStarPoints(100, 5, pos, rad, true));
        earth.add(createStarPoints(500, 3, pos, rad));
        earth.add(createStarPoints(2000, 2, pos, rad));

        // position and point the camera to the center of the scene
        camera.position.x = 8;

        camera.lookAt(new THREE.Vector3(0, 0, 0));

        // vr
		var controls = new THREE.VRControls(camera);
		var effect = new THREE.VREffect(webGLRenderer);
controls = new THREE.DeviceOrientationControls(camera);
effect = new THREE.CardboardEffect(webGLRenderer);
        //if (WEBVR.isAvailable() === true) {
        //    document.body.appendChild(WEBVR.getButton(effect));
        //}
//        var controls = new THREE.OrbitControls(camera);
//        controls.autoRotate = false;
        var clock = new THREE.Clock();

        var ambi = new THREE.AmbientLight(0x181818);
        scene.add(ambi);

        var spotLight = new THREE.DirectionalLight(0xffffff);
        spotLight.position.set(100, 0, 150);
        earth.add(spotLight);

        var directionalLight = new THREE.DirectionalLight(0xffffff);
        directionalLight.position.copy(spotLight.position.clone().negate());
        directionalLight.intensity = 0.7;
        earth.add(directionalLight);

        // add the output of the renderer to the html element
        document.getElementById("WebGL-output").appendChild(webGLRenderer.domElement);
webGLRenderer.domElement.webkitRequestFullScreen();

        // call the render function
        var step = 0;


        render();

        function createEarthMesh(geom) {
            var textureLoader = new THREE.TextureLoader();
            var planetTexture = textureLoader.load("assets/textures/planets/Earth.png");
            var specularTexture = textureLoader.load("assets/textures/planets/EarthSpec.png");
            var normalTexture = textureLoader.load("assets/textures/planets/EarthNormal.png");


            var planetMaterial = new THREE.MeshPhongMaterial();
            planetMaterial.specularMap = specularTexture;
            planetMaterial.specular = new THREE.Color(0x4444aa);
            planetMaterial.shininess = 5;
            planetMaterial.normalMap = normalTexture;
            planetMaterial.normalScale = new THREE.Vector2(5, 5);
            planetMaterial.map = planetTexture;


            // create a multimaterial
            var mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);

            return mesh;
        }

        function createAirMesh(geom) {

            var planetMaterial = new THREE.MeshPhongMaterial();
            planetMaterial.side = THREE.BackSide;
            planetMaterial.transparent = true;
            planetMaterial.opacity = 0.2;
            planetMaterial.color = new THREE.Color(0xffffff);

            // create a multimaterial
            var mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);

            return mesh;
        }


        function createMoonMesh(geom) {
            var textureLoader = new THREE.TextureLoader();
            var planetTexture = textureLoader.load("assets/textures/planets/Moon.png");
            var normalTexture = textureLoader.load("assets/textures/planets/Mars-normalmap_2k.png");

            var planetMaterial = new THREE.MeshPhongMaterial();
            planetMaterial.normalMap = normalTexture;
            planetMaterial.normalScale = new THREE.Vector2(5, 5);
            planetMaterial.map = planetTexture;
            planetMaterial.specularMap = planetTexture;
            planetMaterial.specular = new THREE.Color(0x444400);
            planetMaterial.shininess = 0;


            // create a multimaterial
            var mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [planetMaterial]);

            return mesh;
        }

        function createStarPoints(num, size, center, radius, red) {
            var geom = new THREE.Geometry();

            var textureLoader = new THREE.TextureLoader();
            var texture = textureLoader.load(red ? 
                "assets/textures/lensflare/lensflare0.png" :
                "assets/textures/lensflare/lensflare0_white.png");
            var material = new THREE.PointsMaterial({size: size, map: texture});

            for (var i = 0; i < num; i++) {
                var theta = Math.random() * 2 * Math.PI;
                var phi = Math.random() * 2 * Math.PI;
                var r = radius * (1.5 + Math.random() / 10);
                var particle = new THREE.Vector3(
                    r * Math.sin(theta) * Math.cos(phi),
                    r * Math.sin(theta) * Math.sin(phi),
                    r * Math.cos(theta)
                );
                geom.vertices.push(particle);
            }
            cloud = new THREE.Points(geom, material);
            cloud.sortParticles = true;
            return cloud;
        }

        function render() {
            stats.update();

            var delta = clock.getDelta();
            //controls.update(delta);
            controls.update();

earth.rotation.z -= 0.001;
//            earth.rotation.x -= 0.001;
//            earth.rotation.y += Math.sin(earth.rotation.x) / 500;
//            earth.rotation.z = 0.5 + Math.cos(earth.rotation.x) / 500;;

//            earth.position.y = -10 + Math.sin(earth.rotation.x * 2);
//            air.position.copy(earth.position);
//            camera.position.x = 8 - Math.sin(earth.rotation.x * 2);
//camera.position.set(15, 15, 15);

            // render using requestAnimationFrame
            requestAnimationFrame(render);
            // vr
            //webGLRenderer.render(scene, camera);
			effect.render(scene, camera);
        }

        function initStats() {

            var stats = new Stats();
            stats.setMode(0); // 0: fps, 1: ms

            // Align top-left
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.left = '0px';
            stats.domElement.style.top = '0px';

            document.getElementById("Stats-output").appendChild(stats.domElement);

            return stats;
        }
    }
    window.onload = init;
</script>
</body>
</html>
